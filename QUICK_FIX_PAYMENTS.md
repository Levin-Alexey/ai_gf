# üöÄ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - 3 –®–ê–ì–ê

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê
–ü–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –ÆKassa, –Ω–æ –ø–æ–¥–ø–∏—Å–∫–∞ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –®–ê–ì 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–£–ñ–ï –°–î–ï–õ–ê–ù–û –õ–û–ö–ê–õ–¨–ù–û)
–§–∞–π–ª `webhook_server.py` —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω. –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:

```python
# –í–º–µ—Å—Ç–æ:
stmt = update(User).where(...).values(subscription_expires_at=expires_at)
await session.execute(stmt)

# –¢–µ–ø–µ—Ä—å:
user.subscription_expires_at = expires_at
session.add(user)
await session.commit()
await session.refresh(user)
```

### –®–ê–ì 2: –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /path/to/AI_GF
git pull origin main
sudo systemctl restart ai-gf-webhook.service
```

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python diagnose_payment_system.py

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo journalctl -u ai-gf-webhook.service -f
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –í—Ä—É—á–Ω—É—é –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∞):
```bash
python test_webhook_locally.py <telegram_id> activate 7
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
python test_webhook_locally.py <telegram_id> check
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üì® –ü–æ–ª—É—á–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: payment.succeeded
üí∞ –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ ID: ...
‚è≥ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è 123456789 –Ω–∞ 30 –¥–Ω–µ–π...
‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞/–ø—Ä–æ–¥–ª–µ–Ω–∞ –¥–ª—è 123456789 –Ω–∞ 30 –¥–Ω–µ–π –¥–æ 2025-12-21
```

–ò –≤ –ë–î:
```
‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –ê–ö–¢–ò–í–ù–ê (–æ—Å—Ç–∞–ª–æ—Å—å 30 –¥–Ω–µ–π)
```

---

## ‚ö° –ï–°–õ–ò –°–†–û–ß–ù–û –ù–£–ñ–ù–û –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ü–û–î–ü–ò–°–ö–£ –í–†–£–ß–ù–£–Æ

```bash
# 1. –£–∑–Ω–∞—Ç—å telegram_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ÆKassa metadata –∏–ª–∏ –∏–∑ –ë–î

# 2. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
.\venv\Scripts\Activate.ps1
python test_webhook_locally.py <telegram_id> activate 30

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
python test_webhook_locally.py <telegram_id> check
```

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 21.11.2025  
**–§–∞–π–ª—ã:** `webhook_server.py`, —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
