# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ aio-pika (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π RabbitMQ)

## üîç –ü—Ä–æ–±–ª–µ–º–∞
–í–∞—à –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é** –±–∏–±–ª–∏–æ—Ç–µ–∫—É `pika` –≤ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º** –∫–æ–¥–µ aiogram. –≠—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ event loop, –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥—å RabbitMQ.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ö–æ–¥ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `aio-pika` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è RabbitMQ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π —Å asyncio.

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. **requirements.txt**
   - –ó–∞–º–µ–Ω–µ–Ω–æ: `pika==1.3.2` ‚Üí `aio-pika==9.4.3`

### 2. **queue_client.py**
   - –í–µ—Å—å –∫–ª–∞—Å—Å `QueueClient` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
   - –í—Å–µ –º–µ—Ç–æ–¥—ã —Ç–µ–ø–µ—Ä—å `async`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `aio_pika.connect_robust()` –≤–º–µ—Å—Ç–æ `pika.BlockingConnection`

### 3. **main.py**
   - `queue_client.connect()` ‚Üí `await queue_client.connect()`
   - `queue_client.disconnect()` ‚Üí `await queue_client.disconnect()`

### 4. **handlers/chat.py**
   - `queue_client.publish_message()` ‚Üí `await queue_client.publish_message()`

### 5. **llm_worker.py**
   - `queue_client.connect()` ‚Üí `await queue_client.connect()`
   - `queue_client.disconnect()` ‚Üí `await queue_client.disconnect()`
   - `queue_client.consume_requests()` ‚Üí `await queue_client.consume_requests()`
   - `handle_llm_request()` —Ç–µ–ø–µ—Ä—å `async`

### 6. –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
   - **test_rabbitmq.py** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ async
   - **test_system.py** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã queue_client
   - **diagnostics.py** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è test_rabbitmq_connection()

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ù–∞ VDS (Linux):
```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
pip uninstall pika -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
pip install aio-pika==9.4.3

# –ò–ª–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –ù–∞ Windows:
```cmd
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
venv\Scripts\activate

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
pip uninstall pika -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
pip install aio-pika==9.4.3

# –ò–ª–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:

```bash
# –¢–µ—Å—Ç RabbitMQ
python test_rabbitmq.py

# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
python diagnostics.py

# –¢–µ—Å—Ç –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
python test_system.py
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - event loop —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `connect_robust()`  
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ  
‚úÖ **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤  

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RabbitMQ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `.env` —Ñ–∞–π–ª–µ:
  ```
  RABBITMQ_HOST=5.23.53.246
  RABBITMQ_PORT=5672
  RABBITMQ_USER=admin
  RABBITMQ_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
  RABBITMQ_VHOST=/
  ```

## üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ VDS

–ò–∑ –≤–∞—à–µ–≥–æ –ª–æ–≥–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ RabbitMQ –Ω–∞ VDS —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `aio-pika` –≤—Å–µ –¥–æ–ª–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å:

```bash
# –ù–∞ VDS
cd /root/ai_gf
source venv/bin/activate
pip install aio-pika==9.4.3
python test_rabbitmq.py
```

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
python main.py

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞
python run_worker.py
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è aio-pika](https://aio-pika.readthedocs.io/)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](https://github.com/mosquito/aio-pika/tree/master/docs/source/examples)

