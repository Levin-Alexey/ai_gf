# üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ÆKassa –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Telegram)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ 1. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –ë–æ—Ç (handlers/payment.py)                   ‚îÇ
‚îÇ  ‚Ä¢ –°–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ –ÆKassa API                  ‚îÇ
‚îÇ  ‚Ä¢ –î–æ–±–∞–≤–ª—è–µ—Ç metadata (telegram_id, days)           ‚îÇ
‚îÇ  ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ 2. –°–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –ÆKassa API                             ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–ª–∞—Ç—ë–∂                                 ‚îÇ
‚îÇ  ‚Ä¢ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Webhook —Å–µ—Ä–≤–µ—Ä (webhook_server.py)             ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å                                ‚îÇ
‚îÇ  ‚Ä¢ –ò–∑–≤–ª–µ–∫–∞–µ—Ç metadata                               ‚îÇ
‚îÇ  ‚Ä¢ –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –≤ –ë–î                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ 4. –û–±–Ω–æ–≤–ª—è–µ—Ç subscription_expires_at
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            PostgreSQL Database                      ‚îÇ
‚îÇ  users.subscription_expires_at = NOW() + days       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**Windows:**
```bash
.\install_payment_deps.bat
```

**Linux/Mac:**
```bash
bash install_payment_deps.sh
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```bash
pip install yookassa==3.3.0
pip install fastapi==0.115.4
pip install uvicorn[standard]==0.32.0
pip install pydantic==2.9.2
```

---

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

–î–æ–±–∞–≤—å—Ç–µ (—É–∂–µ –µ—Å—Ç—å):
```env
PAYMENT_SHOP_ID=1181697
PAYMENT_SECRET_KEY=live_Ee4j3Lp9erVpLw6YTZSaqj-pEGvAVjGA0ZMi8pSPUog
WEBHOOK_URL=https://your-server.com:8000/webhook/yookassa
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ó–∞–º–µ–Ω–∏—Ç–µ `your-server.com` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –∏–ª–∏ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞!

---

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ –ÆKassa

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://yookassa.ru/my/shop-settings
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**
3. –î–æ–±–∞–≤—å—Ç–µ URL: `https://your-server.com:8000/webhook/yookassa`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded` (—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂)
   - ‚úÖ `payment.canceled` (–æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂)

---

### 4. –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 8000

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# Ubuntu/Debian
sudo ufw allow 8000/tcp

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl http://localhost:8000/health
```

–û—Ç–≤–µ—Ç: `{"status":"healthy","timestamp":"..."}`

---

## üîß –ó–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä—É—á–Ω—É—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - –ë–æ—Ç:**
```bash
python main.py
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - Webhook:**
```bash
python webhook_server.py
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Systemd (–¥–ª—è production)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–æ–≤:

**`/etc/systemd/system/ai-gf-bot.service`:**
```ini
[Unit]
Description=AI GF Telegram Bot
After=network.target postgresql.service

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/AI_GF
Environment="PATH=/path/to/AI_GF/venv/bin"
ExecStart=/path/to/AI_GF/venv/bin/python main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**`/etc/systemd/system/ai-gf-webhook.service`:**
```ini
[Unit]
Description=AI GF Payment Webhook
After=network.target postgresql.service

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/AI_GF
Environment="PATH=/path/to/AI_GF/venv/bin"
ExecStart=/path/to/AI_GF/venv/bin/python webhook_server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**–ó–∞–ø—É—Å–∫:**
```bash
sudo systemctl daemon-reload
sudo systemctl enable ai-gf-bot ai-gf-webhook
sudo systemctl start ai-gf-bot ai-gf-webhook
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
sudo systemctl status ai-gf-bot
sudo systemctl status ai-gf-webhook
```

**–õ–æ–≥–∏:**
```bash
sudo journalctl -u ai-gf-bot -f
sudo journalctl -u ai-gf-webhook -f
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —Å–µ—Ä–≤–µ—Ä–∞

```bash
curl http://localhost:8000/health
```

–û—Ç–≤–µ—Ç:
```json
{"status":"healthy","timestamp":"2025-10-22T14:30:00+00:00"}
```

---

### 2. –¢–µ—Å—Ç–æ–≤–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

**–ë–µ–∑ –æ–ø–ª–∞—Ç—ã (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):**
```bash
curl -X POST http://localhost:8000/webhook/test \
  -H "Content-Type: application/json" \
  -d '{"telegram_id": 782769400, "days": 30}'
```

–û—Ç–≤–µ—Ç:
```json
{"status":"success","message":"–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"}
```

---

### 3. –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ –≤ –±–æ—Ç–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `/start`
2. –ù–∞–∂–º–∏—Ç–µ "üí¨ –ù–∞—á–∞—Ç—å —á–∞—Ç"
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ 6 —Å–æ–æ–±—â–µ–Ω–∏–π (–ø—Ä–µ–≤—ã—Å–∏—Ç–µ –ª–∏–º–∏—Ç)
4. –ù–∞–∂–º–∏—Ç–µ "üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ
6. –ù–∞–∂–º–∏—Ç–µ "üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"

–í **—Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ** –ÆKassa –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ä—Ç—É:
```
–ù–æ–º–µ—Ä: 5555 5555 5555 4444
–°—Ä–æ–∫: 12/24
CVC: 123
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ webhook

```bash
# –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /var/log/ai-gf-webhook.log

# –ò–ª–∏ —á–µ—Ä–µ–∑ journalctl
sudo journalctl -u ai-gf-webhook -f
```

**–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂:**
```
INFO - üì® –ü–æ–ª—É—á–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: payment.succeeded
INFO - ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è 782769400 –Ω–∞ 30 –¥–Ω–µ–π –¥–æ 2025-11-21
INFO - ‚úÖ –ü–ª–∞—Ç—ë–∂ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è 782769400
```

**–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å:**
```
WARNING - ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è –ø–æ–¥–ø–∏—Å—å webhook!
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook

Webhook —Å–µ—Ä–≤–µ—Ä **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –ÆKassa:

```python
def verify_webhook_signature(body: bytes, signature: str) -> bool:
    expected = hmac.new(
        PAYMENT_SECRET_KEY.encode(),
        body,
        hashlib.sha256
    ).hexdigest()
    
    return hmac.compare_digest(signature, expected)
```

‚ö†Ô∏è **–ë–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è!**

---

### HTTPS –¥–ª—è production

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx –∫–∞–∫ reverse proxy
2. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx:

```nginx
server {
    listen 443 ssl;
    server_name your-server.com;
    
    ssl_certificate /etc/letsencrypt/live/your-server.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-server.com/privkey.pem;
    
    location /webhook/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## üí∞ –¢–∞—Ä–∏—Ñ—ã

| –ü–µ—Ä–∏–æ–¥ | –¶–µ–Ω–∞ | –î–Ω–µ–π | –°–∫–∏–¥–∫–∞ |
|--------|------|------|--------|
| 1 –º–µ—Å—è—Ü | 299‚ÇΩ | 30 | - |
| 3 –º–µ—Å—è—Ü–∞ | 699‚ÇΩ | 90 | -22% |
| 1 –≥–æ–¥ | 1999‚ÇΩ | 365 | -44% |

–¢–∞—Ä–∏—Ñ—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `handlers/payment.py`:

```python
plans = {
    "1m": {"name": "1 –º–µ—Å—è—Ü", "price": 299, "days": 30},
    "3m": {"name": "3 –º–µ—Å—è—Ü–∞", "price": 699, "days": 90},
    "1y": {"name": "1 –≥–æ–¥", "price": 1999, "days": 365}
}
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `curl http://localhost:8000/health`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç 8000: `sudo netstat -tulpn | grep 8000`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –ÆKassa (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS –¥–ª—è production)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u ai-gf-webhook -f`

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid signature"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `PAYMENT_SECRET_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–ª—é—á–æ–º –≤ –ÆKassa
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á**, –∞ –Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ metadata –≤ –ø–ª–∞—Ç–µ–∂–µ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `telegram_id` –∏ `days`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook: `sudo journalctl -u ai-gf-webhook -f`

---

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `PAYMENT_SHOP_ID` –∏ `PAYMENT_SECRET_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω –≤ –ÆKassa
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –º–∞–≥–∞–∑–∏–Ω–∞ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞: `sudo journalctl -u ai-gf-bot -f`

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ÆKassa API:** https://yookassa.ru/developers/api
- **Webhook –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://yookassa.ru/developers/using-api/webhooks
- **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:** https://yookassa.ru/my
- **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:** https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing

---

## üéØ –ò—Ç–æ–≥–æ

‚úÖ **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫**  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π**  
‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**  
‚úÖ **Systemd —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞**  

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `.\install_payment_deps.bat`
2. –î–æ–±–∞–≤–∏—Ç—å `WEBHOOK_URL` –≤ `.env`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å webhook —Å–µ—Ä–≤–µ—Ä: `python webhook_server.py`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ –ÆKassa
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç—ë–∂!

üöÄ **–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏—ë–º—É –¥–µ–Ω–µ–≥!** üí∞
